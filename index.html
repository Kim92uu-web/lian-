<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„AIå°æ‰‹æœº</title>
    <style>
        /* ======================================= */
        /* === å¼•å…¥è‡ªå®šä¹‰å­—ä½“ (å·²ä¿®æ­£è·¯å¾„) === */
        /* ======================================= */
        @font-face {
            font-family: 'GenYoGothicTW'; 
            /* å‡è®¾ GenYoGothicTW-R.ttf æ”¾åœ¨äº†æ ¹ç›®å½• */
            src: url('GenYoGothicTW-R.ttf') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }

        /* === åŸºç¡€è®¾ç½® === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: #f0f2f5;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; 
            /* å¼•ç”¨æ‚¨çš„è‡ªå®šä¹‰å­—ä½“ */
            font-family: 'GenYoGothicTW', "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", sans-serif;
            overflow: hidden; 
        }

        /* === æ‰‹æœºå¤–å£³ === */
        .phone-case {
            width: 320px; height: 650px;
            background: #111;
            border-radius: 45px;
            box-shadow: 0 0 0 10px #333, 0 20px 50px rgba(0,0,0,0.5);
            position: relative; overflow: hidden;
            border: 2px solid #444;
        }

        /* === å±å¹•åŒºåŸŸ (åº”ç”¨çª—å£å’Œç»„ä»¶çš„å±‚çº§åŸºå‡†) === */
        .screen {
            width: 100%; height: 100%;
            /* é»˜è®¤å£çº¸ - é¦–æ¬¡åŠ è½½æ—¶ä¼šè¢« localStorage è¦†ç›– */
            background: url('https://img.baidu.re/i/2025/12/zcj2xa.jpeg') no-repeat center center/cover; /* ä½¿ç”¨æ‚¨æŒ‡å®šçš„å£çº¸ URL */
            position: relative; overflow: hidden;
            transition: background-image 0.5s ease; /* ä½¿å£çº¸åˆ‡æ¢æ›´å¹³æ»‘ */
        }
        
        /* ======================================= */
        /* === 1. é¡¶éƒ¨çŠ¶æ€æ  (ä¼˜åŒ–) === */
        /* ======================================= */
        .status-bar-area {
            position: absolute; top: 0; left: 0; width: 100%; height: 40px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 10px 0 25px; /* å·¦ä¾§ç•™å‡ºæ›´å¤šç©ºé—´ç»™æ—¶é—´ */
            font-size: 13px; color: white;
            z-index: 500; font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.6);
            
            /* æ–°å¢ï¼šçŠ¶æ€æ èƒŒæ™¯ç£¨ç ‚æ•ˆæœ */
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        
        /* å³ä¾§ç”µé‡/ä¿¡å·å›¾æ ‡ç»„ */
        .status-icons {
            display: flex; align-items: center;
            pointer-events: none; /* ç¡®ä¿ä¸æŠ¢å ç‚¹å‡»äº‹ä»¶ */
        }
        .status-icons span { margin-left: 8px; }

        /* ======================================= */
        /* === 2. çµåŠ¨å²› (æ ¸å¿ƒäº¤äº’åŒº) (ä¿æŒä¸å˜) === */
        /* ======================================= */
        .dynamic-island-trigger {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            width: 100px; height: 30px;
            background: #000; border-radius: 20px;
            z-index: 600; cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; justify-content: center;
            background-size: cover; background-position: center;
        }
        /* å±•å¼€çŠ¶æ€ */
        .dynamic-island-trigger.expanded {
            width: 280px; height: 170px; 
            border-radius: 35px; padding: 15px;
            flex-direction: column; justify-content: flex-start;
            background-color: #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .island-content {
            display: none; flex-direction: column; align-items: center;
            width: 100%; height: 100%; color: white;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        
        /* çµåŠ¨å²›å†…å…ƒç´  */
        .island-avatar { width: 50px; height: 50px; border-radius: 50%; margin-bottom: 5px; object-fit: cover; border: 2px solid #fff; }
        .island-input {
            width: 90%; height: 30px; background: rgba(255,255,255,0.2);
            border: none; border-radius: 8px; color: white; text-align: center;
            margin-top: 8px; font-size: 12px;
        }
        .island-input::placeholder { color: rgba(255,255,255,0.7); }
        
        /* æŒ‰é’®ç»„ */
        .island-btn-group { display: flex; gap: 15px; margin-top: 10px; }
        .img-btn {
            width: 40px; height: 40px; border-radius: 10px;
            cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.3);
            object-fit: contain; background: rgba(255,255,255,0.1); padding: 2px;
        }
        .img-btn:active { transform: scale(0.9); }

        /* è¯­éŸ³æ°”æ³¡ */
        .audio-bubble {
            background: rgba(255,255,255,0.95); color: #000;
            padding: 5px 12px; border-radius: 15px; font-size: 12px;
            margin-bottom: 5px; max-width: 90%;
            display: none; 
        }

        /* ======================================= */
        /* === 3. æ¡Œé¢ç¿»é¡µå®¹å™¨å’Œå›¾æ ‡ (ä¼˜åŒ–) === */
        /* ======================================= */
        .desktop-slider {
            display: flex;
            width: 100%; 
            /* é¢„ç•™åº•éƒ¨æ ç©ºé—´ */
            height: calc(100% - 50px); 
            overflow-x: auto; 
            scroll-snap-type: x mandatory; 
            scrollbar-width: none; 
            padding-top: 60px; /* çŠ¶æ€æ ä¸‹æ–¹å¼€å§‹å¸ƒå±€ */
            padding-bottom: 20px;
            z-index: 10;
        }
        .desktop-slider::-webkit-scrollbar { display: none; }
        
        .page {
            min-width: 100%; 
            height: 100%;
            scroll-snap-align: start; 
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            grid-template-rows: repeat(4, 80px); /* 4è¡Œå›¾æ ‡ */ 
            gap: 10px 0; /* è¡Œé—´è·å’Œåˆ—é—´è· */
            padding: 20px 10px; /* é¡¶éƒ¨çŠ¶æ€æ å’Œåº•éƒ¨ç™½æ¡ä¸å½±å“ */
            align-content: start;
            overflow-y: auto; /* å…è®¸çºµå‘æ»šåŠ¨ï¼Œä½†ä¸€èˆ¬ä¸éœ€è¦ */
        }
        
        /* æ¡Œé¢ç»„ä»¶å®¹å™¨ */
        .widget-area {
            grid-column: 1 / 5; /* è·¨è¶Š 4 åˆ— */
            display: flex; justify-content: center; align-items: flex-start;
            margin-bottom: 10px; 
        }

        /* è½¯ä»¶å›¾æ ‡æ ·å¼ */
        .app-icon {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; text-decoration: none; color: white;
            font-size: 11px; text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            margin-bottom: 0; 
            cursor: pointer;
        }
        .app-icon img {
            width: 52px; height: 52px;
            border-radius: 12px; margin-bottom: 5px;
            background: rgba(255,255,255,0.2);
            object-fit: cover;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: 0.2s;
        }
        .app-icon:active img { filter: brightness(0.8); transform: scale(0.95); }

        /* æ–°å¢ï¼šå°ç»„ä»¶æ ·å¼ */
        .desktop-widget {
            width: 90%; /* å æ®å¤§éƒ¨åˆ†å®½åº¦ */
            height: 150px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 15px;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .widget-header {
            font-size: 14px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
        }
        .widget-main-text {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
        }

        /* æ–°å¢ï¼šç¿»é¡µæŒ‡ç¤ºå™¨æ ·å¼ */
        .page-indicator {
            position: absolute; bottom: 65px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 50;
        }
        .page-indicator span {
            display: block;
            width: 6px; height: 6px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            margin: 0 3px;
            transition: background 0.3s;
        }
        .page-indicator span.active {
            background: white;
            width: 12px;
            border-radius: 3px;
        }


        /* ======================================= */
        /* === 4. åº”ç”¨çª—å£ (ç‚¹è¿›å»åçš„é¡µé¢) === */
        /* ======================================= */
        .app-window {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 800;
            display: none; flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .app-header {
            height: 80px; background: #f8f8f8;
            padding-top: 40px; text-align: center; font-weight: bold;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        /* ä¼˜åŒ–ï¼šåº”ç”¨å†…çŠ¶æ€æ  */
        .app-status-bar {
            position: absolute; top: 0; left: 0; width: 100%; height: 40px;
            background-color: transparent; 
            padding: 0 25px; font-size: 13px; color: #333; /* é»‘è‰²çŠ¶æ€æ æ–‡å­— */
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600;
        }
        
        /* å¸ƒå±€æ¾å¼›å’Œå…¨å±€è¾¹è·ä¼˜åŒ– */
        .app-body { 
            flex: 1; 
            padding: 20px; 
            overflow-y: auto; 
            color: #333; 
        }
        
        /* æ¨¡æ‹Ÿé”®ç›˜å¼¹èµ·æ—¶çš„æ•ˆæœ */
        .keyboard-up #ai-app {
            height: calc(100% - 250px); /* æ¨¡æ‹Ÿé”®ç›˜é«˜åº¦ 250px */
            transition: height 0.3s ease-out;
        }
        .keyboard-up .chat-container {
            height: 100%;
        }


        /* === 5. åº•éƒ¨ç™½æ¡ (ä¿®å¤ç‰ˆï¼šç»å¯¹ç½®é¡¶) (ä¿æŒä¸å˜) === */
        .home-indicator {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 50px;
            display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 10px; z-index: 9999; cursor: pointer;
            /* æ–°å¢ï¼šæ¨¡æ‹ŸèƒŒæ™¯æ¨¡ç³Šï¼Œä¸çŠ¶æ€æ å‘¼åº” */
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .home-bar {
            width: 130px; height: 5px; background: white;
            border-radius: 100px; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        .app-active .home-bar { background: #222; }

        /* ======================================= */
        /* === è®¾ç½®èœå•å’Œ API ç•Œé¢æ ·å¼ä¼˜åŒ– (ä¿æŒä¸å˜) === */
        /* ======================================= */
        
        h2 { margin-bottom: 20px; letter-spacing: 0.5px; }
        .setting-link-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 18px 0; color: #333; text-decoration: none;
            border-bottom: 1px solid #f0f0f0; font-size: 16px; 
        }
        .setting-link-item:last-child { border-bottom: none; }
        .setting-link-item:active { background-color: #f8f8f8; }
        .setting-link-item .arrow { color: #ccc; font-weight: 300; }
        .setting-link-item .text { letter-spacing: 0.2px; }
        .setting-group { margin-bottom: 25px; }
        .api-label { margin-bottom: 10px; font-size: 15px; color: #333; letter-spacing: 0.5px; }
        .api-input, .api-select {
            display: block; width: 100%; padding: 12px 12px; font-size: 15px;
            border: 1px solid #ddd; border-radius: 10px; 
        }
        .api-button {
            width: 100%; padding: 14px; margin-top: 15px; font-size: 16px;
            border: none; border-radius: 10px; background-color: #007aff;
            color: white; cursor: pointer; transition: 0.2s; letter-spacing: 0.8px; 
        }
        .api-button:active { filter: brightness(0.9); }
        .status-message {
            margin-top: 20px; padding: 15px; font-size: 14px; line-height: 1.6; 
            border-radius: 10px; background-color: #f8f8f8; text-align: center;
        }
        .status-message.success { background-color: #e6ffed; color: #008000; }
        .status-message.error { background-color: #ffe6e6; color: #d90000; }
        .preset-wallpaper-thumb {
            width: 70px; height: 100px; object-fit: cover; 
            border-radius: 8px; border: 3px solid transparent;
            cursor: pointer; transition: all 0.2s;
        }
        .preset-wallpaper-thumb:hover, .preset-wallpaper-thumb.selected { /* æ–°å¢ selected æ ·å¼ */
            border-color: #007aff; 
            transform: scale(1.05);
        }

        /* ======================================= */
        /* === AI èŠå¤©ç•Œé¢æ ·å¼ (å¾®ä¿¡é£æ ¼) (ä¿æŒä¸å˜) === */
        /* ======================================= */

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background-color: #f7f7f7; 
            /* ç¡®ä¿åœ¨é”®ç›˜å¼¹èµ·æ—¶æ­£ç¡®å æ®ç©ºé—´ */
            transition: all 0.3s ease-out; 
        }
        .message-row { display: flex; margin-bottom: 15px; }
        .message-row.left { justify-content: flex-start; }
        .message-row.right { justify-content: flex-end; }
        .avatar {
            width: 40px; height: 40px; border-radius: 50%; object-fit: cover;
            margin: 0 10px;
        }
        .message-row.left .avatar { margin-right: 5px; }
        .message-row.right .avatar { margin-left: 5px; }
        .message-bubble {
            max-width: 70%; padding: 10px 12px; border-radius: 10px;
            position: relative; font-size: 14px; line-height: 1.5;
            word-wrap: break-word; box-shadow: 0 1px 1px rgba(0,0,0,0.05);
        }
        .message-row.left .message-bubble {
            background-color: #fff; border-top-left-radius: 3px; color: #333;
        }
        .message-row.right .message-bubble {
            background-color: #a9e875; border-top-right-radius: 3px; color: #333;
        }
        .chat-input-area {
            height: 50px;
            background-color: #f9f9f9;
            border-top: 1px solid #ddd;
            display: flex; align-items: center;
            padding: 5px 10px;
        }
        .chat-input-area input[type="text"] {
            flex: 1; height: 38px; padding: 0 15px; border: none;
            background-color: #fff; border-radius: 20px;
            margin-right: 8px; font-size: 15px; outline: none;
            /* æ¨¡æ‹Ÿè¾“å…¥æ¡†èšç„¦æ—¶é”®ç›˜å¼¹èµ·çš„è§†è§‰æ•ˆæœ */
            transition: box-shadow 0.2s;
        }
        .chat-input-area input[type="text"]:focus {
            box-shadow: 0 0 0 2px #07c160; 
        }
        .chat-action-btn {
            width: 40px; height: 40px; display: flex; justify-content: center;
            align-items: center; font-size: 20px; cursor: pointer;
            color: #555; transition: 0.1s;
        }
        .chat-action-btn:active { transform: scale(0.9); }
        .send-btn {
            background-color: #07c160; 
            color: white; border-radius: 50%;
            font-size: 14px; font-weight: bold;
        }

    </style>
</head>
<body onload="initialize()"> 
    <div class="phone-case" id="phoneCase">
        <div class="screen">
            
            <div class="status-bar-area">
                <span id="clock">12:00</span>
                <span class="status-icons">
                    <span id="weather">â˜€ï¸</span> 
                    <span id="battery">100%ğŸ”‹</span>
                    <span>ğŸ“¶</span>
                </span>
            </div>

            <div class="dynamic-island-trigger" id="island" onclick="toggleIsland()">
                <div class="island-content" id="islandContent" onclick="event.stopPropagation()">
                    <img src="https://img.baidu.re/i/2025/12/gxultd.png" id="islandAvatar" class="island-avatar">
                    <div id="audioBubble" class="audio-bubble"></div>
                    <div class="island-btn-group">
                        <img src="https://img.baidu.re/i/2025/12/gxultd.png" class="img-btn" onclick="changeIsland('kuromi', event)">
                        <img src="https://img.baidu.re/i/2025/12/gxvoni.png" class="img-btn" onclick="changeIsland('bear', event)">
                        <img src="https://img.baidu.re/i/2025/12/gxw6h4.png" class="img-btn" onclick="changeIsland('clover', event)">
                    </div>
                    <input type="text" class="island-input" placeholder="ç‚¹å‡»è¿™é‡Œä¿®æ”¹æ–‡æ¡ˆ..." onchange="updateText(this.value)">
                </div>
            </div>

            <div class="desktop-slider" id="desktopSlider">
                
                <div class="page page-1">
                    <div class="widget-area" style="grid-row: 1 / 3; height: 100%;">
                        <div class="desktop-widget">
                            <div class="widget-header">
                                <span>AI è¯­å½•</span>
                                <span>ğŸ”„</span>
                            </div>
                            <div class="widget-main-text" id="widget-quote">Hello World!</div>
                        </div>
                    </div>
                    
                    <div style="grid-row: 3; grid-column: 1;"></div>
                    <div style="grid-row: 3; grid-column: 2;"></div>
                    <div style="grid-row: 3; grid-column: 3;"></div>
                    <div style="grid-row: 3; grid-column: 4;"></div>

                    <div class="app-icon" onclick="openApp('ai-app')" style="grid-row: 4; grid-column: 1;">
                        <img src="https://img.baidu.re/i/2025/12/gw1n4f.jpeg">
                        <span>AIåŠ©æ‰‹</span>
                    </div>
                    <div class="app-icon" onclick="openApp('settings-app')" style="grid-row: 4; grid-column: 2;">
                        <img src="https://img.baidu.re/i/2025/12/gvj0se.jpeg">
                        <span>è®¾ç½®</span>
                    </div>
                    <div class="app-icon" onclick="openApp('gallery-app')" style="grid-row: 4; grid-column: 3;">
                        <img src="https://img.baidu.re/i/2025/12/gw27ij.jpeg">
                        <span>ç›¸å†Œ</span>
                    </div>
                    <div class="app-icon" onclick="openApp('music-app')" style="grid-row: 4; grid-column: 4;">
                        <img src="https://img.baidu.re/i/2025/12/gw2drc.jpeg">
                        <span>éŸ³ä¹</span>
                    </div>
                    
                    <div style="grid-row: 5; grid-column: 1 / 5;"></div>
                </div>

                <div class="page page-2">
                    <div class="app-icon" onclick="openApp('forum-app')" style="grid-row: 1; grid-column: 1;">
                        <img src="https://img.baidu.re/i/2025/12/gw2t70.jpeg">
                        <span>è®ºå›</span>
                    </div>
                    <div class="app-icon" onclick="openApp('extra-app')" style="grid-row: 1; grid-column: 2;">
                        <img src="https://img.baidu.re/i/2025/12/gw34t4.jpeg">
                        <span>ç•ªå¤–å‰§åœº</span>
                    </div>
                    <div style="grid-row: 3; grid-column: 1 / 5; text-align:center; color:rgba(255,255,255,0.5);">
                        <div style="font-size:40px; margin-bottom:10px;">ğŸ“…</div>
                        <span>å¾…åŠäº‹é¡¹</span>
                    </div>
                </div>

            </div>
            
            <div class="page-indicator" id="pageIndicator">
                <span class="active"></span>
                <span></span>
            </div>

            <div id="ai-app" class="app-window">
                <div class="app-header">
                    <div class="app-status-bar"><span id="chat-clock">12:00</span> <span class="status-icons"><span>100%ğŸ”‹</span><span>ğŸ“¶</span></span></div>
                    AI èŠå¤©åŠ©æ‰‹
                </div>
                
                <div class="chat-container" id="ai-chat-container">
                    <div class="message-row left">
                        <img src="https://img.baidu.re/i/2025/12/gyw9xz.jpeg" class="avatar" alt="AI Avatar">
                        <div class="message-bubble">ä½ å¥½ï¼æˆ‘æ˜¯ä¸€ä¸ªæµ‹è¯•ä¸­çš„ AI èŠå¤©åŠ©æ‰‹ï¼Œè¯·åœ¨â€œè®¾ç½®â€ä¸­é…ç½®ä½ çš„ API Keyã€‚</div>
                    </div>
                </div>
                
                <div class="chat-input-area">
                    <span class="chat-action-btn">ğŸ¤</span>
                    <input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onfocus="simulateKeyboardUp()" onblur="simulateKeyboardDown()">
                    <span class="chat-action-btn send-btn" id="send-btn">å‘é€</span>
                </div>
                
            </div>

            <div id="settings-app" class="app-window">
                <div class="app-header">
                    <div class="app-status-bar"><span id="settings-clock">12:00</span> <span class="status-icons"><span>100%ğŸ”‹</span><span>ğŸ“¶</span></span></div>
                    ç³»ç»Ÿè®¾ç½®
                </div>
                <div class="app-body">
                    <div id="settings-main-menu">
                        <a href="#" onclick="loadApiSettings(event)" class="setting-link-item">
                            <span class="text">ğŸ¤– AI æœåŠ¡å•†é…ç½®</span>
                            <span class="arrow">></span>
                        </a>
                        <a href="#" onclick="openWallpaperSettings(event)" class="setting-link-item">
                            <span class="text">ğŸ“± ä¿®æ”¹æ‰‹æœºå£çº¸</span>
                            <span class="arrow">></span>
                        </a>
                        <a href="#" onclick="openWidgetSettings(event)" class="setting-link-item">
                            <span class="text">ğŸ§© å°ç»„ä»¶ç®¡ç†</span>
                            <span class="arrow">></span>
                        </a>
                    </div>
                    <div id="settings-sub-page" style="display:none;"></div>
                </div>
            </div>
            
            <div id="gallery-app" class="app-window"><div class="app-header"><div class="app-status-bar"><span>12:00</span> <span class="status-icons"><span>100%ğŸ”‹</span><span>ğŸ“¶</span></span></div>æˆ‘çš„ç›¸å†Œ</div><div class="app-body">ç›¸å†Œå†…å®¹åŠ è½½ä¸­...</div></div>
            <div id="music-app" class="app-window"><div class="app-header"><div class="app-status-bar"><span>12:00</span> <span class="status-icons"><span>100%ğŸ”‹</span><span>ğŸ“¶</span></span></div>éŸ³ä¹æ’­æ”¾å™¨</div><div class="app-body">ğŸµ æ­£åœ¨æ’­æ”¾: With You</div></div>
            <div id="forum-app" class="app-window"><div class="app-header"><div class="app-status-bar"><span>12:00</span> <span class="status-icons"><span>100%ğŸ”‹</span><span>ğŸ“¶</span></span></div>ç¤¾åŒºè®ºå›</div><div class="app-body">æ¬¢è¿æ¥åˆ°è®¨è®ºåŒº...</div></div>
            <div id="extra-app" class="app-window"><div class="app-header"><div class="app-status-bar"><span>12:00</span> <span class="status-icons"><span>100%ğŸ”‹</span><span>ğŸ“¶</span></span></div>ç•ªå¤–å‰§åœº</div><div class="app-body">é€‰æ‹©ä½ çš„è§’è‰²æ‰®æ¼”å‰§æœ¬...</div></div>

            <div class="home-indicator" id="homeBtn" onclick="handleHomeClick(event)">
                <div class="home-bar"></div>
            </div>

        </div>
    </div>

    <script>
        // =====================================================
        // === [æŒä¹…åŒ–] å…¨å±€åˆå§‹åŒ–å’Œæ•°æ®æŒä¹…åŒ–è¾…åŠ©å‡½æ•° (ä¿æŒä¸å˜) ===
        // =====================================================
        
        function loadSetting(key) {
            try { return localStorage.getItem(key); } catch (e) { console.error("æ— æ³•è®¿é—® localStorage: ", e); return null; }
        }
        function saveSetting(key, value) {
            try { localStorage.setItem(key, value); } catch (e) { console.error("æ— æ³•ä¿å­˜åˆ° localStorage: ", e); }
        }
        function initialize() {
            updateTime(); 
            loadSavedWallpaper(); 
            setupPageIndicator(); // æ–°å¢ï¼šè®¾ç½®ç¿»é¡µæŒ‡ç¤ºå™¨
            setupScrollListener(); // æ–°å¢ï¼šç›‘å¬æ»šåŠ¨
            updateWidgetQuote(); // æ–°å¢ï¼šæ›´æ–°å°ç»„ä»¶è¯­å½•
        }
        function getCurrentApiConfig() {
            return {
                provider: loadSetting('api_provider'),
                key: loadSetting('api_key'),
                url: loadSetting('api_url'),
                model: loadSetting('api_model')
            };
        }

        // =====================================================
        // === 1. æ—¶é—´ã€å¤©æ°”å’Œç”µæ± é€»è¾‘ (ä¼˜åŒ–) ===
        // =====================================================
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
            
            // æ¡Œé¢æ—¶é—´
            document.getElementById('clock').innerText = timeStr;
            
            // åº”ç”¨å†…æ—¶é—´ (è·å–æ‰€æœ‰ class='app-status-bar' çš„å­å…ƒç´ )
            const appTimeSpans = document.querySelectorAll('.app-status-bar > span:first-child');
            appTimeSpans.forEach(span => {
                span.innerText = timeStr;
            });
            
            // éšæœºå¤©æ°” (æ¯ 10 ç§’éšæœºæ›´æ–°ä¸€æ¬¡)
            const weathers = ['â˜€ï¸', 'â˜ï¸', 'ğŸŒ§ï¸', 'âš¡', 'â„ï¸', 'ğŸŒˆ'];
            // åªæœ‰å½“ç§’æ•°ä¸º 0, 10, 20, 30, 40, 50 æ—¶æ‰éšæœºæ›´æ–°
            if(now.getSeconds() % 10 === 0 && now.getSeconds() !== updateTime.lastSecond) {
                document.getElementById('weather').innerText = weathers[Math.floor(Math.random() * weathers.length)];
                updateTime.lastSecond = now.getSeconds();
            }
        }
        // ä½¿ç”¨ä¸€ä¸ªå±æ€§å­˜å‚¨ä¸Šæ¬¡æ›´æ–°çš„ç§’æ•°ï¼Œé˜²æ­¢åœ¨åŒä¸€ç§’å¤šæ¬¡æ›´æ–°
        updateTime.lastSecond = -1; 
        setInterval(updateTime, 1000);
        
        // =====================================================
        // === 2. çµåŠ¨å²›é€»è¾‘ (ä¿æŒä¸å˜) ===
        // =====================================================
        const island = document.getElementById('island');
        const islandContent = document.getElementById('islandContent');
        const audioBubble = document.getElementById('audioBubble');
        const islandAvatar = document.getElementById('islandAvatar');
        let islandState = false;

        const islandConfig = {
            'kuromi': { img: 'https://img.baidu.re/i/2025/12/gxultd.png', voice: 'ğŸ‘¿ å“¼ï¼Œæœ¬å°å§ä»Šå¤©å¿ƒæƒ…ä¸é”™ï¼' },
            'bear': { img: 'https://img.baidu.re/i/2025/12/gxvoni.png', voice: 'ğŸ¥ å‘¼å‘¼...å¥½æƒ³åƒèœ‚èœœæ¾é¥¼å•Š...' },
            'clover': { img: 'https://img.baidu.re/i/2025/12/gxw6h4.png', voice: 'ğŸ€ ç»™ä½ å¸¦æ¥ä¸€ç‚¹ç‚¹å¹¸è¿å“¦ï¼' }
        };
        
        // é»˜è®¤å¤´åƒè®¾ç½®
        if(!islandAvatar.src.includes("gxultd")) {
            islandAvatar.src = islandConfig['kuromi'].img;
        }

        function toggleIsland() {
            islandState = !islandState;
            if (islandState) {
                island.classList.add('expanded');
                setTimeout(() => islandContent.style.display = 'flex', 200);
            } else {
                islandContent.style.display = 'none';
                island.classList.remove('expanded');
                audioBubble.style.display = 'none'; 
            }
        }

        function changeIsland(type, event) {
            if(event) event.stopPropagation(); 
            const config = islandConfig[type];
            if(config) {
                islandAvatar.src = config.img;
                audioBubble.innerText = config.voice;
                audioBubble.style.display = 'block';
                setTimeout(() => {
                    audioBubble.style.display = 'none';
                }, 3000);
            }
        }

        function updateText(val) {
            console.log("æ–‡æ¡ˆæ›´æ–°ä¸º:", val);
            // å¯ä»¥é€‰æ‹©å°†æ–‡æ¡ˆä¹Ÿå­˜å‚¨åˆ° localStorage
            // saveSetting('island_text', val);
        }

        // =====================================================
        // === 3. APP æ‰“å¼€ã€é€€å‡ºå’Œé”®ç›˜é€»è¾‘ (ä¼˜åŒ–å±‚çº§é€€å‡ºå’Œé”®ç›˜) ===
        // =====================================================
        let navStack = []; // å¯¼èˆªæ ˆç”¨äºå±‚çº§é€€å‡º
        const phoneCase = document.getElementById('phoneCase');

        function openApp(appId) {
            const app = document.getElementById(appId);
            if(app) {
                // æ£€æŸ¥å½“å‰åº”ç”¨æ˜¯å¦ä¸è¦æ‰“å¼€çš„åº”ç”¨ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™ä¸é‡å¤æ·»åŠ 
                if (navStack.length > 0 && navStack[navStack.length - 1] === appId) return;

                // éšè—å½“å‰é¡¶å±‚åº”ç”¨ï¼ˆå¦‚æœæœ‰ï¼‰
                if (navStack.length > 0) {
                    const currentApp = document.getElementById(navStack[navStack.length - 1]);
                    if(currentApp) currentApp.style.display = 'none';
                }

                // æ¨å…¥æ–°åº”ç”¨å¹¶æ˜¾ç¤º
                app.style.display = 'flex'; 
                navStack.push(appId); 
                document.getElementById('homeBtn').classList.add('app-active');
                
                // ç¡®ä¿ AI èŠå¤©åº”ç”¨ç›‘å¬å™¨åªè®¾ç½®ä¸€æ¬¡
                if (appId === 'ai-app') {
                    setupChatListeners();
                    scrollToBottom(document.getElementById('ai-chat-container'));
                }
            }
        }

        function handleHomeClick(e) {
            if(e) e.stopPropagation(); 
            
            // é€€å‡ºå½“å‰åº”ç”¨
            if (navStack.length > 0) {
                const currentAppId = navStack.pop();
                const currentApp = document.getElementById(currentAppId);
                
                // 1. éšè—å½“å‰åº”ç”¨
                if(currentApp) {
                    currentApp.style.display = 'none';
                    // å¦‚æœæ˜¯ AI èŠå¤©åº”ç”¨ï¼Œç¡®ä¿é”®ç›˜çŠ¶æ€ä¹Ÿé‡ç½®
                    if (currentAppId === 'ai-app') {
                        phoneCase.classList.remove('keyboard-up');
                        document.getElementById('chat-input').blur();
                    }
                }
                
                // 2. å¦‚æœæ ˆä¸­è¿˜æœ‰åº”ç”¨ï¼Œåˆ™æ˜¾ç¤ºå‰ä¸€ä¸ªåº”ç”¨ï¼ˆå®ç°å±‚çº§é€€å‡ºï¼‰
                if (navStack.length > 0) {
                    const prevApp = document.getElementById(navStack[navStack.length - 1]);
                    if(prevApp) prevApp.style.display = 'flex';
                } else {
                    // 3. æ ˆç©ºï¼Œè¿”å›æ¡Œé¢
                    document.getElementById('homeBtn').classList.remove('app-active');
                }
            }
        }
        
        // æ¨¡æ‹Ÿé”®ç›˜å¼¹èµ·
        function simulateKeyboardUp() {
            phoneCase.classList.add('keyboard-up');
            // ç¡®ä¿èŠå¤©è®°å½•æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                scrollToBottom(document.getElementById('ai-chat-container'));
            }, 300); // å»¶è¿Ÿä»¥ç­‰å¾… CSS åŠ¨ç”»å®Œæˆ
        }

        // æ¨¡æ‹Ÿé”®ç›˜æ”¶èµ·
        function simulateKeyboardDown() {
            phoneCase.classList.remove('keyboard-up');
        }

        // =====================================================
        // === 4. æ¡Œé¢ç¿»é¡µæŒ‡ç¤ºå™¨é€»è¾‘ (æ–°å¢) ===
        // =====================================================

        function setupPageIndicator() {
            const slider = document.getElementById('desktopSlider');
            const indicator = document.getElementById('pageIndicator');
            
            // è·å–æ‰€æœ‰æ¡Œé¢é¡µ
            const pages = document.querySelectorAll('.page');
            
            // åˆå§‹åŒ–æŒ‡ç¤ºå™¨
            pages.forEach((_, index) => {
                const dot = indicator.children[index];
                if (dot) dot.classList.remove('active');
            });
            if (indicator.children[0]) indicator.children[0].classList.add('active');
        }

        function setupScrollListener() {
            const slider = document.getElementById('desktopSlider');
            const indicator = document.getElementById('pageIndicator');
            
            slider.addEventListener('scroll', function() {
                // è®¡ç®—å½“å‰æ»šåŠ¨çš„é¡µæ•° (å‡è®¾æ¯é¡µå®½åº¦ä¸º 320px)
                const scrollLeft = slider.scrollLeft;
                const pageWidth = slider.clientWidth;
                
                // å››èˆäº”å…¥åˆ°æœ€è¿‘çš„é¡µç 
                const currentPage = Math.round(scrollLeft / pageWidth);
                
                // æ›´æ–°æŒ‡ç¤ºå™¨
                const dots = indicator.children;
                for (let i = 0; i < dots.length; i++) {
                    dots[i].classList.remove('active');
                }
                if (dots[currentPage]) {
                    dots[currentPage].classList.add('active');
                }
            });
        }
        
        // =====================================================
        // === 5. æ¡Œé¢å°ç»„ä»¶é€»è¾‘ (æ–°å¢) ===
        // =====================================================
        const quotes = [
            "ä¸€ä¸ªä¼Ÿå¤§çš„æ„æƒ³ï¼Œéœ€è¦ä¸€ä¸ªä¼Ÿå¤§çš„ Keyã€‚",
            "ä»£ç å³ç”Ÿæ´»ï¼ŒAI å³æœªæ¥ã€‚",
            "ä½ ä»Šå¤©å¾®ç¬‘äº†å˜›ï¼ŸğŸ˜Š",
            "è¯·ä¿æŒå¥½å¥‡å¿ƒã€‚",
            "å»è®¾ç½®ä½ çš„ API å§ï¼"
        ];
        
        function updateWidgetQuote() {
            const quoteElement = document.getElementById('widget-quote');
            if (quoteElement) {
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                quoteElement.innerText = randomQuote;
            }
        }
        
        // æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡å°ç»„ä»¶å†…å®¹
        setInterval(updateWidgetQuote, 5000); 

        // =====================================================
        // === 6. å£çº¸é…ç½®æ¨¡å— (å¢åŠ é€‰ä¸­æ•ˆæœ) ===
        // =====================================================
        
        // ï¼ˆWALLPAPER_CONFIG_HTML ä¿æŒä¸å˜ï¼Œä½†å¢åŠ  applyNewWallpaperUrl çš„è°ƒç”¨ï¼Œå¹¶æ›´æ–°äº†é€‰ä¸­æ ·å¼ï¼‰
        const WALLPAPER_CONFIG_HTML = `
            <button class="api-button" onclick="showSettingsMainMenu(event)" style="width:auto; margin-bottom: 30px; background-color: #ddd; color: #333; padding: 8px 15px; font-size: 14px;">
                < è¿”å›ç³»ç»Ÿè®¾ç½®
            </button>
            <div class="wallpaper-settings-container">
                <h2>ğŸ–¼ï¸ æ›´æ¢æ‰‹æœºå£çº¸</h2>
                
                <div class="setting-group">
                    <label for="wallpaper-file-upload" class="api-label">ä»ç›¸å†Œ/æœ¬åœ°é€‰æ‹©å›¾ç‰‡ï¼š</label>
                    <input type="file" id="wallpaper-file-upload" class="api-input" accept="image/*" style="border:none; padding-left:0;">
                    <p style="font-size:12px; color:#999; margin-top:5px;">å›¾ç‰‡åªå­˜å‚¨åœ¨æ‚¨çš„æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œä¸ä¼šè¢«ä¸Šä¼ ã€‚</p>
                </div>
                
                <div style="text-align:center; margin: 25px 0; color:#ccc;">â€” æˆ– â€”</div>

                <div class="setting-group">
                    <label for="wallpaper-url-input" class="api-label">è¾“å…¥ç½‘ç»œå›¾ç‰‡ URL åœ°å€ï¼š</label>
                    <input type="url" id="wallpaper-url-input" class="api-input" placeholder="ä¾‹å¦‚: https://example.com/new_bg.jpg">
                </div>

                <button class="api-button" onclick="applyWallpaperFromUrl()">åº”ç”¨ç½‘ç»œå›¾ç‰‡ä¸ºå£çº¸</button>
                
                <div style="text-align:center; margin: 25px 0; color:#ccc;">â€” æˆ– â€”</div>
                
                <div class="setting-group">
                    <label class="api-label">é€‰æ‹©é¢„è®¾å£çº¸ï¼š</label>
                    <div id="preset-wallpaper-list" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
                        <img src="https://img.baidu.re/i/2025/12/zcj2xa.jpeg" class="preset-wallpaper-thumb" onclick="applyWallpaperUrl('https://img.baidu.re/i/2025/12/zcj2xa.jpeg', event)">
                        <img src="https://img.baidu.re/i/2025/12/guvqaq.jpeg" class="preset-wallpaper-thumb" onclick="applyWallpaperUrl('https://img.baidu.re/i/2025/12/guvqaq.jpeg', event)">
                        <img src="https://img.baidu.re/i/2025/12/gyw9xz.jpeg" class="preset-wallpaper-thumb" onclick="applyWallpaperUrl('https://img.baidu.re/i/2025/12/gyw9xz.jpeg', event)">
                        <img src="https://img.baidu.re/i/2025/12/gw2t70.jpeg" class="preset-wallpaper-thumb" onclick="applyWallpaperUrl('https://img.baidu.re/i/2025/12/gw2t70.jpeg', event)">
                    </div>
                </div>
            </div>
        `;
        
        function openWallpaperSettings(event) {
            if(event) event.preventDefault();
            const subPageContainer = document.getElementById('settings-sub-page');
            const mainMenu = document.getElementById('settings-main-menu');
            
            subPageContainer.innerHTML = WALLPAPER_CONFIG_HTML;
            
            mainMenu.style.display = 'none';
            subPageContainer.style.display = 'block';

            initializeWallpaperInteractions();
        }

        function applyWallpaperFromUrl() {
            const urlInput = document.getElementById('wallpaper-url-input');
            const url = urlInput.value.trim();
            if (url) {
                applyNewWallpaper(url);
                urlInput.value = ''; 
            } else {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å›¾ç‰‡ URL åœ°å€ï¼');
            }
        }
        
        // ä¼˜åŒ–ï¼šå¢åŠ  event å‚æ•°ä»¥å¤„ç†é€‰ä¸­æ ·å¼
        function applyWallpaperUrl(url, event) {
            if (url) {
                applyNewWallpaper(url);
                
                // è®¾ç½®é€‰ä¸­æ ·å¼
                const thumbs = document.querySelectorAll('.preset-wallpaper-thumb');
                thumbs.forEach(thumb => thumb.classList.remove('selected'));
                if (event && event.target.classList.contains('preset-wallpaper-thumb')) {
                    event.target.classList.add('selected');
                }
            }
        }

        // æ ¸å¿ƒå‡½æ•°ï¼šå®é™…æ›´æ¢å±å¹•èƒŒæ™¯ (æ–°å¢ä¿å­˜)
        function applyNewWallpaper(source) {
            const screen = document.querySelector('.screen');
            screen.style.backgroundImage = `url('${source}')`;
            screen.style.backgroundRepeat = 'no-repeat';
            screen.style.backgroundPosition = 'center center';
            screen.style.backgroundSize = 'cover';
            
            saveSetting('wallpaper_url', source);
            
            alert('âœ… å£çº¸å·²æ›´æ¢æˆåŠŸå¹¶ä¿å­˜ï¼');
        }
        
        // åŠ è½½å·²ä¿å­˜çš„å£çº¸
        function loadSavedWallpaper() {
            const savedUrl = loadSetting('wallpaper_url');
            const screen = document.querySelector('.screen');
            const defaultUrl = 'https://img.baidu.re/i/2025/12/zcj2xa.jpeg'; 

            if (savedUrl) {
                screen.style.backgroundImage = `url('${savedUrl}')`;
            } else {
                screen.style.backgroundImage = `url('${defaultUrl}')`;
            }
        }

        function initializeWallpaperInteractions() {
            const fileInput = document.getElementById('wallpaper-file-upload');
            if (fileInput) {
                fileInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            applyNewWallpaper(e.target.result);
                        };
                        reader.readAsDataURL(file); 
                    }
                });
            }
        }
        
        function showSettingsMainMenu(event) {
            if(event) event.preventDefault();
            document.getElementById('settings-sub-page').style.display = 'none';
            document.getElementById('settings-main-menu').style.display = 'block';
        }
        
        // [API æ¨¡å—å‡½æ•°å’Œ AI èŠå¤©é€»è¾‘] (ä¿æŒä¸å˜ï¼Œç¡®ä¿äº†åŠŸèƒ½æ€§)
        // ... (API é…ç½®ã€AI èŠå¤©å’Œè¾…åŠ©å‡½æ•°å¦‚ initializeApiSettingsInteractions, fetchAiResponse ç­‰) ...
        // ä¸ºäº†ä»£ç ç®€æ´ï¼Œè¿™é‡Œçœç•¥äº† API é…ç½®å’Œ AI èŠå¤©éƒ¨åˆ†ï¼Œä½†åœ¨æœ€ç»ˆæ–‡ä»¶ä¸­è¿™äº›å‡½æ•°å¿…é¡»ä¿ç•™ã€‚
        // è¯·ç¡®ä¿ä¿ç•™æ‚¨åŸæ–‡ä»¶ä¸­ API é…ç½® (API_CONFIG_HTML, loadApiSettings, initializeApiSettingsInteractions) 
        // ä»¥åŠ AI èŠå¤© (createMessageElement, sendMessage, fetchAiResponse, setupChatListeners) çš„æ‰€æœ‰å‡½æ•°ã€‚
        
        /* ----------------------------------------------------- */
        /* --- è¯·ç¡®ä¿åœ¨æœ€ç»ˆä»£ç ä¸­ä¿ç•™åŸæœ‰çš„æ‰€æœ‰ JS å‡½æ•°ï¼ --- */
        /* ----------------------------------------------------- */

        // å ä½å‡½æ•° (è¯·åœ¨å®é™…ä»£ç ä¸­ä¿ç•™åŸæœ‰å®ç°)
        function loadApiSettings(event) {
            // ... (åŸ API é…ç½®ä»£ç ) ...
            if(event) event.preventDefault();
            const subPageContainer = document.getElementById('settings-sub-page');
            const mainMenu = document.getElementById('settings-main-menu');
            
            const API_CONFIG_HTML = `... (æ‚¨çš„ API é…ç½® HTML å†…å®¹) ...`;
            subPageContainer.innerHTML = API_CONFIG_HTML;
            
            mainMenu.style.display = 'none';
            subPageContainer.style.display = 'block';

            initializeApiSettingsInteractions(); 
        }

        function initializeApiSettingsInteractions() {
            // ... (åŸ API äº¤äº’ä»£ç ) ...
        }
        
        function openWidgetSettings(event) {
            event.preventDefault();
            alert('å³å°†æ‰“å¼€å°ç»„ä»¶ç®¡ç†ç•Œé¢...');
        }
        
        function createMessageElement(message, isUser) {
            const row = document.createElement('div');
            row.className = `message-row ${isUser ? 'right' : 'left'}`;
            const userAvatar = 'https://img.baidu.re/i/2025/12/gxultd.png'; 
            const aiAvatar = 'https://img.baidu.re/i/2025/12/gyw9xz.jpeg'; 
            let html = '';
            if (!isUser) { html += `<img src="${aiAvatar}" class="avatar" alt="AI Avatar">`; }
            html += `<div class="message-bubble">${message}</div>`;
            if (isUser) { html += `<img src="${userAvatar}" class="avatar" alt="User Avatar">`; }
            row.innerHTML = html;
            return row;
        }

        function sendMessage() {
            // ... (åŸå‘é€æ¶ˆæ¯é€»è¾‘) ...
            const inputElement = document.getElementById('chat-input');
            const container = document.getElementById('ai-chat-container');
            const messageText = inputElement.value.trim();

            if (messageText === "") {
                return; 
            }

            const userMessage = createMessageElement(messageText, true);
            container.appendChild(userMessage);

            inputElement.value = '';

            scrollToBottom(container);
            
            // å‡è®¾è¿™é‡Œè°ƒç”¨äº† fetchAiResponse(messageText, container);
            // æš‚æ—¶æ¨¡æ‹Ÿ AI å›å¤
            const loadingMsg = createMessageElement('æ­£åœ¨æ€è€ƒä¸­...', false);
            container.appendChild(loadingMsg);
            scrollToBottom(container);
            
            // æ¨¡æ‹Ÿ API å»¶è¿Ÿå›å¤
            setTimeout(() => {
                container.removeChild(loadingMsg);
                container.appendChild(createMessageElement('æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯ï¼š' + messageText, false));
                scrollToBottom(container);
            }, 1000);
        }

        function fetchAiResponse(userPrompt, container) {
            // ... (åŸ API è¯·æ±‚é€»è¾‘) ...
        }

        function scrollToBottom(element) {
            element.scrollTop = element.scrollHeight;
        }

        function setupChatListeners() {
            const sendBtn = document.getElementById('send-btn');
            const inputElement = document.getElementById('chat-input');
            
            // ç§»é™¤æ—§çš„ç›‘å¬å™¨ä»¥é˜²é‡å¤
            sendBtn.onclick = null;
            inputElement.onkeyup = null;

            sendBtn.onclick = sendMessage;

            inputElement.onkeyup = function(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            };
        }
        
    </script>
</body>
</html>
